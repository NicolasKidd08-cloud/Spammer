-- NEXA Complete Script - With Save Position Feature
-- Click "Save Position" to set your base location!

-- Variables
local basePosition = Vector3.new(0, 50, 0) -- Default spawn
local isNoclipEnabled = false
local isTeleportEnabled = false
local noclipConnection = nil
local player = game.Players.LocalPlayer

-- Create GUI
local function createGui()
    local playerGui = player:WaitForChild("PlayerGui")
    
    -- Remove old GUI if exists
    if playerGui:FindFirstChild("NexaTestCheats") then
        playerGui:FindFirstChild("NexaTestCheats"):Destroy()
    end
    
    -- Create ScreenGui
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "NexaTestCheats"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = playerGui
    
    -- Main Frame
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 220, 0, 235)
    mainFrame.Position = UDim2.new(0.5, -110, 0.1, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = mainFrame
    
    -- Title
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 35)
    title.BackgroundColor3 = Color3.fromRGB(0, 255, 136)
    title.Text = "NEXA Cheats"
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.TextColor3 = Color3.fromRGB(20, 20, 20)
    title.Parent = mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 10)
    titleCorner.Parent = title
    
    -- Noclip Button
    local noclipButton = Instance.new("TextButton")
    noclipButton.Name = "NoclipButton"
    noclipButton.Size = UDim2.new(0, 200, 0, 35)
    noclipButton.Position = UDim2.new(0, 10, 0, 50)
    noclipButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    noclipButton.Text = "Noclip: OFF"
    noclipButton.Font = Enum.Font.GothamBold
    noclipButton.TextSize = 13
    noclipButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    noclipButton.Parent = mainFrame
    
    local noclipCorner = Instance.new("UICorner")
    noclipCorner.CornerRadius = UDim.new(0, 8)
    noclipCorner.Parent = noclipButton
    
    -- Auto-TP Button
    local teleportButton = Instance.new("TextButton")
    teleportButton.Name = "TeleportButton"
    teleportButton.Size = UDim2.new(0, 200, 0, 35)
    teleportButton.Position = UDim2.new(0, 10, 0, 95)
    teleportButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    teleportButton.Text = "Auto-TP: OFF"
    teleportButton.Font = Enum.Font.GothamBold
    teleportButton.TextSize = 13
    teleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    teleportButton.Parent = mainFrame
    
    local teleportCorner = Instance.new("UICorner")
    teleportCorner.CornerRadius = UDim.new(0, 8)
    teleportCorner.Parent = teleportButton
    
    -- Save Position Button (NEW!)
    local saveButton = Instance.new("TextButton")
    saveButton.Name = "SaveButton"
    saveButton.Size = UDim2.new(0, 200, 0, 30)
    saveButton.Position = UDim2.new(0, 10, 0, 140)
    saveButton.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    saveButton.Text = "üíæ Save Position"
    saveButton.Font = Enum.Font.GothamBold
    saveButton.TextSize = 12
    saveButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    saveButton.Parent = mainFrame
    
    local saveCorner = Instance.new("UICorner")
    saveCorner.CornerRadius = UDim.new(0, 6)
    saveCorner.Parent = saveButton
    
    -- TP to Saved Button
    local tpNowButton = Instance.new("TextButton")
    tpNowButton.Name = "TPNowButton"
    tpNowButton.Size = UDim2.new(0, 200, 0, 30)
    tpNowButton.Position = UDim2.new(0, 10, 0, 178)
    tpNowButton.BackgroundColor3 = Color3.fromRGB(31, 111, 235)
    tpNowButton.Text = "üìç TP to Saved"
    tpNowButton.Font = Enum.Font.GothamBold
    tpNowButton.TextSize = 12
    tpNowButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    tpNowButton.Parent = mainFrame
    
    local tpNowCorner = Instance.new("UICorner")
    tpNowCorner.CornerRadius = UDim.new(0, 6)
    tpNowCorner.Parent = tpNowButton
    
    -- Position Display
    local posDisplay = Instance.new("TextLabel")
    posDisplay.Name = "PosDisplay"
    posDisplay.Size = UDim2.new(0, 200, 0, 20)
    posDisplay.Position = UDim2.new(0, 10, 0, 213)
    posDisplay.BackgroundTransparency = 1
    posDisplay.Text = "No position saved"
    posDisplay.Font = Enum.Font.Gotham
    posDisplay.TextSize = 9
    posDisplay.TextColor3 = Color3.fromRGB(150, 150, 150)
    posDisplay.Parent = mainFrame
    
    -- Make draggable
    local dragging = false
    local dragInput, mousePos, framePos
    
    title.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = mainFrame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    title.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - mousePos
            mainFrame.Position = UDim2.new(
                framePos.X.Scale,
                framePos.X.Offset + delta.X,
                framePos.Y.Scale,
                framePos.Y.Offset + delta.Y
            )
        end
    end)
    
    return noclipButton, teleportButton, saveButton, tpNowButton, posDisplay
end

-- Teleport function
local function teleportToBase()
    pcall(function()
        local character = player.Character
        if not character then return end
        
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then return end
        
        humanoidRootPart.CFrame = CFrame.new(basePosition)
        print("‚úì Teleported to:", basePosition)
    end)
end

-- Save current position
local function saveCurrentPosition(posDisplay)
    pcall(function()
        local character = player.Character
        if not character then 
            print("‚ùå No character found")
            return 
        end
        
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then 
            print("‚ùå No HumanoidRootPart found")
            return 
        end
        
        -- Save position
        basePosition = humanoidRootPart.Position
        
        -- Update display
        local x = math.floor(basePosition.X)
        local y = math.floor(basePosition.Y)
        local z = math.floor(basePosition.Z)
        posDisplay.Text = string.format("Saved: %d, %d, %d", x, y, z)
        posDisplay.TextColor3 = Color3.fromRGB(0, 255, 136)
        
        print("‚úì Position saved:", basePosition)
        
        -- Flash the save button
        local saveBtn = posDisplay.Parent:FindFirstChild("SaveButton")
        if saveBtn then
            saveBtn.BackgroundColor3 = Color3.fromRGB(0, 255, 136)
            wait(0.3)
            saveBtn.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
        end
    end)
end

-- Noclip function
local function setNoclip(enabled)
    local character = player.Character
    if not character then return end
    
    if enabled then
        noclipConnection = game:GetService("RunService").Stepped:Connect(function()
            pcall(function()
                if player.Character then
                    for _, part in pairs(player.Character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end
            end)
        end)
        print("‚úì Noclip ENABLED")
    else
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
        
        pcall(function()
            if player.Character then
                for _, part in pairs(player.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = true
                    end
                end
            end
        end)
        print("‚úì Noclip DISABLED")
    end
end

-- Auto-TP loop
local function startAutoTP()
    spawn(function()
        while isTeleportEnabled do
            teleportToBase()
            wait(5)
        end
    end)
end

-- Main execution
print("üöÄ Loading NEXA Cheats...")

-- Create GUI
local noclipButton, teleportButton, saveButton, tpNowButton, posDisplay = createGui()

-- Connect Noclip Button
noclipButton.MouseButton1Click:Connect(function()
    isNoclipEnabled = not isNoclipEnabled
    noclipButton.Text = isNoclipEnabled and "Noclip: ON" or "Noclip: OFF"
    noclipButton.BackgroundColor3 = isNoclipEnabled and Color3.fromRGB(0, 255, 136) or Color3.fromRGB(60, 60, 60)
    setNoclip(isNoclipEnabled)
end)

-- Connect Auto-TP Button
teleportButton.MouseButton1Click:Connect(function()
    isTeleportEnabled = not isTeleportEnabled
    teleportButton.Text = isTeleportEnabled and "Auto-TP: ON" or "Auto-TP: OFF"
    teleportButton.BackgroundColor3 = isTeleportEnabled and Color3.fromRGB(0, 255, 136) or Color3.fromRGB(60, 60, 60)
    
    if isTeleportEnabled then
        print("‚úì Auto-TP started (every 5 seconds)")
        startAutoTP()
    else
        print("‚úì Auto-TP stopped")
    end
end)

-- Connect Save Position Button (NEW!)
saveButton.MouseButton1Click:Connect(function()
    saveCurrentPosition(posDisplay)
end)

-- Connect TP to Saved Button
tpNowButton.MouseButton1Click:Connect(function()
    teleportToBase()
end)

-- Re-enable noclip on respawn
player.CharacterAdded:Connect(function(character)
    wait(1)
    if isNoclipEnabled then
        print("Character respawned - re-enabling noclip...")
        setNoclip(false)
        wait(0.1)
        setNoclip(true)
    end
end)

print("‚úì NEXA Cheats loaded!")
print("‚úì Stand at your base and click 'Save Position'")
print("‚úì Then use 'TP to Saved' or enable 'Auto-TP'")
