-- NEXA â†’ CHILLI AUTO-PASTE BRIDGE (In-Game)
-- Targets: Chilli Hub â†’ UI â†’ Servers â†’ Job ID Input

local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

print("ğŸ”— NEXA â†’ Chilli Bridge Loading...")

-- Settings
local AUTO_PASTE = true
local AUTO_CLICK_JOIN = true
local CHECK_INTERVAL = 0.5

-- Find NEXA Job Monitor GUI
local function findNexaGui()
    return playerGui:FindFirstChild("NexaJobMonitor")
end

-- Find NEXA's Job ID textbox
local function findNexaJobInput()
    local nexaGui = findNexaGui()
    if not nexaGui then return nil end
    
    for _, obj in pairs(nexaGui:GetDescendants()) do
        if obj:IsA("TextBox") then
            if obj.Name:find("Input") or obj.PlaceholderText:find("job") then
                return obj
            end
        end
    end
    
    return nil
end

-- Find Chilli Hub GUI
local function findChilliGui()
    local possibleNames = {
        "ChilliHub",
        "Chilli Hub",
        "Chilli",
        "ChilliGUI",
        "chillihub",
        "ScreenGui"
    }
    
    for _, name in pairs(possibleNames) do
        local gui = playerGui:FindFirstChild(name)
        if gui then
            -- Verify it's Chilli by looking for "chilli" text
            for _, obj in pairs(gui:GetDescendants()) do
                if obj:IsA("TextLabel") and obj.Text and obj.Text:lower():find("chilli") then
                    print("âœ… Found Chilli Hub GUI:", name)
                    return gui
                end
            end
        end
    end
    
    return nil
end

-- Find the Servers section in Chilli
local function findServersSection()
    local chilliGui = findChilliGui()
    if not chilliGui then return nil end
    
    -- Look for Servers frame/section
    for _, obj in pairs(chilliGui:GetDescendants()) do
        if obj:IsA("Frame") or obj:IsA("ScrollingFrame") then
            local name = obj.Name:lower()
            
            if name:find("server") or name == "Servers" then
                print("âœ… Found Servers section:", obj:GetFullName())
                return obj
            end
            
            -- Check if any child has "servers" text
            for _, child in pairs(obj:GetChildren()) do
                if child:IsA("TextLabel") and child.Text and child.Text:lower():find("server") then
                    print("âœ… Found Servers section via label:", obj:GetFullName())
                    return obj
                end
            end
        end
    end
    
    return nil
end

-- Find Chilli's Job ID input in Servers section
local function findChilliJobInput()
    local chilliGui = findChilliGui()
    if not chilliGui then 
        print("âŒ Chilli Hub GUI not found")
        return nil 
    end
    
    -- First, try to find the Servers section
    local serversSection = findServersSection()
    
    if serversSection then
        -- Look for Job ID input inside Servers section
        for _, obj in pairs(serversSection:GetDescendants()) do
            if obj:IsA("TextBox") then
                local name = obj.Name:lower()
                local placeholder = obj.PlaceholderText and obj.PlaceholderText:lower() or ""
                local parent = obj.Parent and obj.Parent.Name:lower() or ""
                
                -- Check if it's the Job ID input
                if name:find("job") or name:find("id") or
                   placeholder:find("job") or placeholder:find("id") or placeholder:find("paste") or
                   parent:find("job") or parent:find("id") then
                    print("âœ… Found Chilli Job ID Input:", obj:GetFullName())
                    return obj
                end
            end
        end
    end
    
    -- Fallback: Search entire Chilli GUI for Job ID input
    print("âš ï¸ Servers section not found, searching entire GUI...")
    
    for _, obj in pairs(chilliGui:GetDescendants()) do
        if obj:IsA("TextBox") then
            local name = obj.Name:lower()
            local placeholder = obj.PlaceholderText and obj.PlaceholderText:lower() or ""
            
            -- Be more specific - look for "job" specifically
            if (name:find("job") and name:find("id")) or
               (placeholder:find("job") and placeholder:find("id")) or
               placeholder:find("paste") or placeholder:find("enter job") then
                print("âœ… Found Chilli Job ID Input (fallback):", obj:GetFullName())
                return obj
            end
        end
    end
    
    print("âŒ Chilli Job ID input not found")
    print("ğŸ’¡ Make sure you're on the 'Servers' tab in Chilli Hub")
    return nil
end

-- Find Chilli's join button in Servers section
local function findChilliJoinButton()
    local serversSection = findServersSection()
    
    if serversSection then
        -- Look for join button in Servers section
        for _, obj in pairs(serversSection:GetDescendants()) do
            if obj:IsA("TextButton") or obj:IsA("ImageButton") then
                local text = obj.Text and obj.Text:lower() or ""
                local name = obj.Name:lower()
                
                if text:find("join") or text:find("enter") or text:find("teleport") or
                   name:find("join") or name:find("enter") or name:find("teleport") or
                   text == ">" or text == "â†’" or text == "go" then
                    print("âœ… Found Join Button:", obj:GetFullName())
                    return obj
                end
            end
        end
    end
    
    -- Fallback: Search entire Chilli GUI
    local chilliGui = findChilliGui()
    if chilliGui then
        for _, obj in pairs(chilliGui:GetDescendants()) do
            if obj:IsA("TextButton") or obj:IsA("ImageButton") then
                local text = obj.Text and obj.Text:lower() or ""
                local name = obj.Name:lower()
                
                if (text:find("join") or name:find("join")) and 
                   (text:find("server") or name:find("server")) then
                    print("âœ… Found Join Button (fallback):", obj:GetFullName())
                    return obj
                end
            end
        end
    end
    
    return nil
end

-- Paste Job ID into Chilli
local function pasteIntoChilli(jobId)
    if not jobId or jobId == "" or jobId == "Waiting for job..." then
        return false
    end
    
    local chilliInput = findChilliJobInput()
    
    if chilliInput then
        -- Paste the job ID
        chilliInput.Text = jobId
        print("âœ… Pasted into Chilli:", jobId)
        
        -- Visual feedback
        pcall(function()
            local originalColor = chilliInput.BackgroundColor3
            chilliInput.BackgroundColor3 = Color3.fromRGB(0, 255, 136)
            task.wait(0.3)
            chilliInput.BackgroundColor3 = originalColor
        end)
        
        -- Try to focus the textbox (some GUIs require this)
        pcall(function()
            chilliInput:CaptureFocus()
            task.wait(0.1)
            chilliInput:ReleaseFocus()
        end)
        
        -- Try to click join button if auto-click is enabled
        if AUTO_CLICK_JOIN then
            task.wait(0.3)
            local joinButton = findChilliJoinButton()
            
            if joinButton then
                print("ğŸ”˜ Attempting to click join button...")
                
                -- Try multiple click methods
                local clicked = false
                
                -- Method 1: Fire all connections
                pcall(function()
                    local connections = getconnections(joinButton.MouseButton1Click)
                    if connections and #connections > 0 then
                        for _, connection in pairs(connections) do
                            connection:Fire()
                            clicked = true
                        end
                    end
                end)
                
                -- Method 2: Direct fire
                pcall(function()
                    joinButton.MouseButton1Click:Fire()
                    clicked = true
                end)
                
                -- Method 3: Simulate mouse click
                pcall(function()
                    local VirtualInputManager = game:GetService("VirtualInputManager")
                    local pos = joinButton.AbsolutePosition
                    local size = joinButton.AbsoluteSize
                    VirtualInputManager:SendMouseButtonEvent(
                        pos.X + size.X/2, 
                        pos.Y + size.Y/2, 
                        0, true, joinButton, 0
                    )
                    VirtualInputManager:SendMouseButtonEvent(
                        pos.X + size.X/2, 
                        pos.Y + size.Y/2, 
                        0, false, joinButton, 0
                    )
                    clicked = true
                end)
                
                if clicked then
                    print("âœ… Clicked Chilli join button")
                else
                    print("âš ï¸ Couldn't click join - click it manually")
                end
            else
                print("âš ï¸ Join button not found - click it manually in Chilli")
            end
        end
        
        return true
    else
        print("âŒ Chilli Job ID input not found")
        print("ğŸ’¡ Make sure:")
        print("   1. Chilli Hub is loaded")
        print("   2. You're on the 'Servers' tab")
        print("   3. The Job ID input field is visible")
        return false
    end
end

-- Main monitoring loop
local lastJobId = ""
local nexaCheckAttempts = 0
local chilliCheckAttempts = 0

task.spawn(function()
    task.wait(2) -- Wait for everything to load
    
    while task.wait(CHECK_INTERVAL) do
        -- Check if NEXA exists
        local nexaInput = findNexaJobInput()
        
        if nexaInput then
            if nexaCheckAttempts > 0 then
                print("âœ… NEXA Monitor reconnected!")
                nexaCheckAttempts = 0
            end
            
            local currentJobId = nexaInput.Text
            
            -- If Job ID changed and auto-paste is enabled
            if AUTO_PASTE and currentJobId ~= lastJobId and 
               currentJobId ~= "" and currentJobId ~= "Waiting for job..." then
                
                lastJobId = currentJobId
                
                print("")
                print("ğŸ”¥ NEW JOB ID DETECTED:", currentJobId)
                print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
                
                -- Try to paste into Chilli
                task.wait(0.3)
                
                local success = pasteIntoChilli(currentJobId)
                
                if success then
                    chilliCheckAttempts = 0
                    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
                    print("âœ… SUCCESSFULLY SYNCED TO CHILLI!")
                    print("")
                else
                    chilliCheckAttempts = chilliCheckAttempts + 1
                    if chilliCheckAttempts == 1 then
                        print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
                        print("âš ï¸ CHILLI HUB NOT READY")
                        print("ğŸ’¡ Open Chilli Hub and go to Servers tab")
                        print("")
                    end
                end
            end
        else
            nexaCheckAttempts = nexaCheckAttempts + 1
            if nexaCheckAttempts == 1 then
                print("âš ï¸ NEXA Monitor not found - execute NEXA script first!")
            end
        end
    end
end)

-- Manual command to test pasting
_G.PasteToChilli = function(jobId)
    local nexaInput = findNexaJobInput()
    local id = jobId or (nexaInput and nexaInput.Text) or ""
    return pasteIntoChilli(id)
end

-- Command to toggle auto-paste
_G.ToggleAutoPaste = function()
    AUTO_PASTE = not AUTO_PASTE
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print("Auto-Paste:", AUTO_PASTE and "ENABLED âœ…" or "DISABLED âŒ")
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    return AUTO_PASTE
end

-- Command to toggle auto-click join
_G.ToggleAutoJoin = function()
    AUTO_CLICK_JOIN = not AUTO_CLICK_JOIN
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print("Auto-Click Join:", AUTO_CLICK_JOIN and "ENABLED âœ…" or "DISABLED âŒ")
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    return AUTO_CLICK_JOIN
end

-- Debug command to find Chilli elements
_G.FindChilliElements = function()
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    print("ğŸ” SEARCHING FOR CHILLI ELEMENTS...")
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    
    local gui = findChilliGui()
    if gui then
        print("âœ… Chilli GUI found:", gui.Name)
    else
        print("âŒ Chilli GUI not found")
    end
    
    local servers = findServersSection()
    if servers then
        print("âœ… Servers section found:", servers:GetFullName())
    else
        print("âŒ Servers section not found")
    end
    
    local input = findChilliJobInput()
    if input then
        print("âœ… Job ID Input found:", input:GetFullName())
        print("   Placeholder:", input.PlaceholderText)
    else
        print("âŒ Job ID Input not found")
    end
    
    local button = findChilliJoinButton()
    if button then
        print("âœ… Join Button found:", button:GetFullName())
        print("   Text:", button.Text)
    else
        print("âŒ Join Button not found")
    end
    
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
end

print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
print("âœ… NEXA â†’ CHILLI BRIDGE LOADED!")
print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
print("ğŸ”„ Watching for Job ID changes...")
print("")
print("ğŸ“‹ MANUAL COMMANDS:")
print("  _G.PasteToChilli('jobId') - Paste a Job ID now")
print("  _G.ToggleAutoPaste() - Toggle auto-paste on/off")
print("  _G.ToggleAutoJoin() - Toggle auto-click join")
print("  _G.FindChilliElements() - Debug: Find Chilli elements")
print("")
print("âš™ï¸ CURRENT SETTINGS:")
print("  Auto-Paste:", AUTO_PASTE and "ENABLED âœ…" or "DISABLED âŒ")
print("  Auto-Click Join:", AUTO_CLICK_JOIN and "ENABLED âœ…" or "DISABLED âŒ")
print("")
print("ğŸ’¡ TIP: Open Chilli Hub â†’ Servers tab before NEXA gets a job!")
print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
